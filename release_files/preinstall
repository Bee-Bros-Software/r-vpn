#!/bin/sh

set -x

LOG_FILE=/var/log/rvpn/preinstall.log

mkdir -p /var/log/rvpn/

{
    echo "Starting R-VPN pre-installation cleanup..."

    # Kill GUI app
    osascript -e 'quit app "R-VPN"' 2>&1 || true
    killall -9 "R-VPN" 2>&1 || true

    # Unload launchd service if it exists
    launchctl unload /Library/LaunchDaemons/net.rsoftware.rvpn.plist 2>&1 || true

    # Kill any remaining rvpn processes directly
    killall -9 rvpn 2>&1 || true

    # Remove launchd plist if it exists
    rm -f /Library/LaunchDaemons/net.rsoftware.rvpn.plist 2>&1 || true

    echo "Pre-installation cleanup completed"
    exit 0
} &> $LOG_FILE
